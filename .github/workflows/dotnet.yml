name: CI - FastTech Testes e Build Local

# ğŸ‘‰ Para executar automaticamente em push/pull_request na branch main, descomente abaixo:
# on:
#   push:
#     branches: [ main ]
#   pull_request:
#     branches: [ main ]

# ğŸ‘‰ ExecuÃ§Ã£o manual via GitHub Actions
on:
  workflow_dispatch:

jobs:
  test-and-build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout do cÃ³digo
      uses: actions/checkout@v3

    - name: ğŸ§° Setup do .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ“¦ Restaurar dependÃªncias
      run: dotnet restore

    - name: ğŸ§ª Executar testes unitÃ¡rios
      run: dotnet test --no-build --configuration Release --filter "Category=Unit"

    - name: ğŸ³ Setup Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: ğŸ—ï¸ Build da imagem `catalogo-api`
      run: |
        docker build -t fasttech/catalogo-api:test \
          -f ./catalogo-api/FastTech.Catalogo/dockerfile \
          ./catalogo-api/FastTech.Catalogo

    - name: ğŸ—ï¸ Build da imagem `auth-api`
      run: |
        docker build -t fasttech/auth-api:test \
          -f ./autenticacao-api/FastTech.Autenticacao/dockerfile \
          ./autenticacao-api/FastTech.Autenticacao

    # ğŸ‘‰ Para habilitar push no Docker Hub, descomente abaixo e adicione os secrets:
    #
    # - name: ğŸ” Login no Docker Hub
    #   uses: docker/login-action@v3
    #   with:
    #     username: ${{ secrets.DOCKER_USERNAME }}
    #     password: ${{ secrets.DOCKER_PASSWORD }}
    #
    # - name: ğŸš€ Push da imagem `catalogo-api`
    #   run: |
    #     docker tag fasttech/catalogo-api:test yourdockeruser/catalogo-api:latest
    #     docker push yourdockeruser/catalogo-api:latest
    #
    # - name: ğŸš€ Push da imagem `auth-api`
    #   run: |
    #     docker tag fasttech/auth-api:test yourdockeruser/auth-api:latest
    #     docker push yourdockeruser/auth-api:latest
